#!/bin/sh

# Import function files
. libs/utils.sh
. libs/init.sh
. libs/container.sh
. libs/variables.sh
. libs/delete.sh
. libs/delete-image.sh
. libs/delete-container.sh
. libs/status.sh
. libs/connect.sh
. libs/run.sh
. libs/stop.sh

help() {
  echo "Docker Workflow Manager"
  echo "Usage: $(basename $0) {command} [subcomand] [--help|-h]"
  echo
  echo "Available commands:"
  echo
  echo  "init\t\tCreate a new docker-managed directory o reinitialize an existing one"
  echo  "delete\t\tSet of tools to delete images and containers"
  echo  "run\t\tCreate a container and run it (or only run it if it exists)"
  echo  "status\t\tDisplay the status of the container"
  echo  "connect\t\tConnect to the container"
  echo  
}

check_initialization() {
  if [ ! -f ${configFile} ]; then
    echo "This directory has not been initialized for $(basename $0)".
    echo
    if ask "Do you want to initialize it now?" Y; then
      prepare_init 
    else
      echo "You need to set up $(basename $0) before using it... exiting"
      exit
    fi
  fi
}

check_config() {
  # TODO: Issue #1: Check configuration file before running commands
  return 1
}

run_checks() {
  check_initialization
  check_config
}

case "$1" in 
	init)
		shift
    prepare_init $@
		;;
  delete)
		shift
    run_checks
		prepare_delete $@
		;;
	run)
		shift
    run_checks
		prepare_run $@
		;;
	stop)
		shift
    run_checks
		prepare_stop $@
		;;
	connect)
		shift
    run_checks
		prepare_connect $@
		;;
	status)
		shift
    run_checks
		prepare_status $@
		;;
	*|--help|-h)
		help
		;;
	esac


